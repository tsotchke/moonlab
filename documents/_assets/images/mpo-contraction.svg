<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500">
  <defs>
    <linearGradient id="mpsGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mpoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="resultGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowRight" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1f2937">MPO-MPS Contraction: Applying Hamiltonian to State</text>

  <!-- MPS (ket) -->
  <g transform="translate(50, 70)">
    <text x="0" y="75" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#7c3aed">|ψ⟩</text>

    <!-- Site 1 -->
    <rect x="40" y="50" width="40" height="40" rx="6" fill="url(#mpsGrad)" stroke="#6d28d9" stroke-width="1.5"/>
    <text x="60" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">A¹</text>
    <line x1="60" y1="50" x2="60" y2="30" stroke="#ef4444" stroke-width="2"/>
    <line x1="80" y1="70" x2="110" y2="70" stroke="#06b6d4" stroke-width="3"/>

    <!-- Site 2 -->
    <rect x="110" y="50" width="40" height="40" rx="6" fill="url(#mpsGrad)" stroke="#6d28d9" stroke-width="1.5"/>
    <text x="130" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">A²</text>
    <line x1="130" y1="50" x2="130" y2="30" stroke="#ef4444" stroke-width="2"/>
    <line x1="150" y1="70" x2="180" y2="70" stroke="#06b6d4" stroke-width="3"/>

    <!-- Site 3 -->
    <rect x="180" y="50" width="40" height="40" rx="6" fill="url(#mpsGrad)" stroke="#6d28d9" stroke-width="1.5"/>
    <text x="200" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">A³</text>
    <line x1="200" y1="50" x2="200" y2="30" stroke="#ef4444" stroke-width="2"/>
    <line x1="220" y1="70" x2="250" y2="70" stroke="#06b6d4" stroke-width="3"/>

    <!-- Site 4 -->
    <rect x="250" y="50" width="40" height="40" rx="6" fill="url(#mpsGrad)" stroke="#6d28d9" stroke-width="1.5"/>
    <text x="270" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">A⁴</text>
    <line x1="270" y1="50" x2="270" y2="30" stroke="#ef4444" stroke-width="2"/>
  </g>

  <!-- MPO (Hamiltonian) -->
  <g transform="translate(50, 170)">
    <text x="0" y="35" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#d97706">H</text>

    <!-- Site 1 -->
    <rect x="40" y="10" width="40" height="40" rx="6" fill="url(#mpoGrad)" stroke="#b45309" stroke-width="1.5"/>
    <text x="60" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">W¹</text>
    <line x1="60" y1="10" x2="60" y2="-10" stroke="#ef4444" stroke-width="2"/>
    <line x1="60" y1="50" x2="60" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="80" y1="30" x2="110" y2="30" stroke="#f59e0b" stroke-width="3"/>

    <!-- Site 2 -->
    <rect x="110" y="10" width="40" height="40" rx="6" fill="url(#mpoGrad)" stroke="#b45309" stroke-width="1.5"/>
    <text x="130" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">W²</text>
    <line x1="130" y1="10" x2="130" y2="-10" stroke="#ef4444" stroke-width="2"/>
    <line x1="130" y1="50" x2="130" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="150" y1="30" x2="180" y2="30" stroke="#f59e0b" stroke-width="3"/>

    <!-- Site 3 -->
    <rect x="180" y="10" width="40" height="40" rx="6" fill="url(#mpoGrad)" stroke="#b45309" stroke-width="1.5"/>
    <text x="200" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">W³</text>
    <line x1="200" y1="10" x2="200" y2="-10" stroke="#ef4444" stroke-width="2"/>
    <line x1="200" y1="50" x2="200" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="220" y1="30" x2="250" y2="30" stroke="#f59e0b" stroke-width="3"/>

    <!-- Site 4 -->
    <rect x="250" y="10" width="40" height="40" rx="6" fill="url(#mpoGrad)" stroke="#b45309" stroke-width="1.5"/>
    <text x="270" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">W⁴</text>
    <line x1="270" y1="10" x2="270" y2="-10" stroke="#ef4444" stroke-width="2"/>
    <line x1="270" y1="50" x2="270" y2="70" stroke="#22c55e" stroke-width="2"/>
  </g>

  <!-- Result MPS -->
  <g transform="translate(50, 310)">
    <text x="0" y="35" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#059669">H|ψ⟩</text>

    <!-- Site 1 -->
    <rect x="40" y="10" width="40" height="40" rx="6" fill="url(#resultGrad)" stroke="#047857" stroke-width="1.5"/>
    <text x="60" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">B¹</text>
    <line x1="60" y1="50" x2="60" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="80" y1="30" x2="110" y2="30" stroke="#10b981" stroke-width="3"/>

    <!-- Site 2 -->
    <rect x="110" y="10" width="40" height="40" rx="6" fill="url(#resultGrad)" stroke="#047857" stroke-width="1.5"/>
    <text x="130" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">B²</text>
    <line x1="130" y1="50" x2="130" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="150" y1="30" x2="180" y2="30" stroke="#10b981" stroke-width="3"/>

    <!-- Site 3 -->
    <rect x="180" y="10" width="40" height="40" rx="6" fill="url(#resultGrad)" stroke="#047857" stroke-width="1.5"/>
    <text x="200" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">B³</text>
    <line x1="200" y1="50" x2="200" y2="70" stroke="#22c55e" stroke-width="2"/>
    <line x1="220" y1="30" x2="250" y2="30" stroke="#10b981" stroke-width="3"/>

    <!-- Site 4 -->
    <rect x="250" y="10" width="40" height="40" rx="6" fill="url(#resultGrad)" stroke="#047857" stroke-width="1.5"/>
    <text x="270" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="white">B⁴</text>
    <line x1="270" y1="50" x2="270" y2="70" stroke="#22c55e" stroke-width="2"/>
  </g>

  <!-- Contraction arrow -->
  <path d="M320 180 L360 180" stroke="#374151" stroke-width="2" marker-end="url(#arrowRight)"/>
  <text x="340" y="170" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#6b7280">contract</text>

  <!-- Single-site contraction detail -->
  <g transform="translate(400, 80)">
    <rect x="0" y="0" width="350" height="180" rx="10" fill="#f9fafb" stroke="#e5e7eb" stroke-width="2"/>
    <text x="175" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#374151">Single-Site Contraction</text>

    <!-- Input tensors -->
    <g transform="translate(40, 50)">
      <rect x="0" y="20" width="35" height="35" rx="5" fill="url(#mpsGrad)"/>
      <text x="17" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="white">A</text>
      <line x1="17" y1="20" x2="17" y2="5" stroke="#ef4444" stroke-width="2"/>
      <text x="17" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#ef4444">σ</text>
      <line x1="0" y1="38" x2="-15" y2="38" stroke="#06b6d4" stroke-width="2"/>
      <text x="-20" y="42" text-anchor="end" font-family="system-ui, sans-serif" font-size="8" fill="#06b6d4">α</text>
      <line x1="35" y1="38" x2="50" y2="38" stroke="#06b6d4" stroke-width="2"/>
      <text x="55" y="42" text-anchor="start" font-family="system-ui, sans-serif" font-size="8" fill="#06b6d4">β</text>
    </g>

    <text x="110" y="95" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" fill="#374151">×</text>

    <g transform="translate(120, 50)">
      <rect x="0" y="20" width="35" height="35" rx="5" fill="url(#mpoGrad)"/>
      <text x="17" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="white">W</text>
      <line x1="17" y1="20" x2="17" y2="5" stroke="#ef4444" stroke-width="2"/>
      <text x="17" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#ef4444">σ</text>
      <line x1="17" y1="55" x2="17" y2="70" stroke="#22c55e" stroke-width="2"/>
      <text x="17" y="80" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#22c55e">σ'</text>
      <line x1="0" y1="38" x2="-15" y2="38" stroke="#f59e0b" stroke-width="2"/>
      <text x="-20" y="42" text-anchor="end" font-family="system-ui, sans-serif" font-size="8" fill="#f59e0b">a</text>
      <line x1="35" y1="38" x2="50" y2="38" stroke="#f59e0b" stroke-width="2"/>
      <text x="55" y="42" text-anchor="start" font-family="system-ui, sans-serif" font-size="8" fill="#f59e0b">b</text>
    </g>

    <text x="195" y="95" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" fill="#374151">=</text>

    <g transform="translate(220, 50)">
      <rect x="0" y="10" width="50" height="50" rx="5" fill="url(#resultGrad)"/>
      <text x="25" y="40" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="white">B</text>
      <line x1="25" y1="60" x2="25" y2="75" stroke="#22c55e" stroke-width="2"/>
      <text x="25" y="85" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#22c55e">σ'</text>
      <line x1="0" y1="35" x2="-15" y2="35" stroke="#10b981" stroke-width="2"/>
      <text x="-25" y="39" text-anchor="end" font-family="system-ui, sans-serif" font-size="8" fill="#10b981">(α,a)</text>
      <line x1="50" y1="35" x2="65" y2="35" stroke="#10b981" stroke-width="2"/>
      <text x="75" y="39" text-anchor="start" font-family="system-ui, sans-serif" font-size="8" fill="#10b981">(β,b)</text>
    </g>

    <!-- Formula -->
    <text x="175" y="155" text-anchor="middle" font-family="serif" font-size="11" fill="#374151">B_{(α,a)(β,b)}^{σ'} = Σ_σ W_{ab}^{σ'σ} A_{αβ}^{σ}</text>
  </g>

  <!-- Bond dimension note -->
  <g transform="translate(400, 280)">
    <rect x="0" y="0" width="350" height="100" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="175" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#92400e">Bond Dimension Growth</text>
    <text x="20" y="50" font-family="system-ui, sans-serif" font-size="11" fill="#374151">• Result bond: χ_new = χ_MPS × χ_MPO</text>
    <text x="20" y="70" font-family="system-ui, sans-serif" font-size="11" fill="#374151">• Requires SVD truncation to control growth</text>
    <text x="20" y="90" font-family="system-ui, sans-serif" font-size="11" fill="#374151">• Keep largest χ singular values</text>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 420)">
    <text x="0" y="15" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#374151">Index Types:</text>
    <line x1="100" y1="10" x2="130" y2="10" stroke="#ef4444" stroke-width="3"/>
    <text x="140" y="15" font-family="system-ui, sans-serif" font-size="10" fill="#374151">Physical (σ): dimension d</text>
    <line x1="280" y1="10" x2="310" y2="10" stroke="#06b6d4" stroke-width="3"/>
    <text x="320" y="15" font-family="system-ui, sans-serif" font-size="10" fill="#374151">MPS bond (α,β): dimension χ</text>
    <line x1="480" y1="10" x2="510" y2="10" stroke="#f59e0b" stroke-width="3"/>
    <text x="520" y="15" font-family="system-ui, sans-serif" font-size="10" fill="#374151">MPO bond (a,b): dimension D</text>
  </g>

  <!-- Complexity -->
  <g transform="translate(50, 455)">
    <text x="0" y="15" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#374151">Complexity:</text>
    <text x="100" y="15" font-family="serif" font-size="11" fill="#374151">O(n · d² · χ² · D²) for full contraction with truncation</text>
  </g>
</svg>
