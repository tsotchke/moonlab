{"version":3,"file":"Playground-D80JRgzL.js","sources":["../../bindings/javascript/demo/src/playground/Playground.tsx"],"sourcesContent":["import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { ensureMoonlabWorker, runCircuitInWorker, type WorkerGate } from '../workers/moonlabClient';\nimport './Playground.css';\n\n// Gate categories for organized display\ntype SingleQubitGate = 'H' | 'X' | 'Y' | 'Z' | 'S' | 'T' | 'Sdg' | 'Tdg' | 'SX' | 'I';\ntype RotationGate = 'Rx' | 'Ry' | 'Rz' | 'P' | 'U';\ntype TwoQubitGate = 'CNOT' | 'CY' | 'CZ' | 'CH' | 'CP' | 'SWAP' | 'iSWAP' | 'DCX';\ntype ThreeQubitGate = 'CCX' | 'CCZ' | 'CSWAP';\ntype SpecialElement = 'M' | 'Reset' | 'Barrier';\n\ntype GateType = SingleQubitGate | RotationGate | TwoQubitGate | ThreeQubitGate | SpecialElement;\n\ninterface Gate {\n  id: string;\n  type: GateType;\n  qubit: number;\n  timeSlot: number;\n  controlQubit?: number;\n  controlQubit2?: number; // For 3-qubit gates\n  targetQubit?: number;   // For multi-qubit gates\n  angle?: number;         // For rotation gates\n}\n\ninterface CircuitState {\n  numQubits: number;\n  numSlots: number;\n  gates: Gate[];\n}\n\ninterface GateInfo {\n  name: string;\n  description: string;\n  color: string;\n  category: 'single' | 'rotation' | 'two-qubit' | 'three-qubit' | 'special';\n  symbol?: string;\n  needsAngle?: boolean;\n  needsControl?: boolean;\n  needsTwoControls?: boolean;\n}\n\nconst GATE_INFO: Record<GateType, GateInfo> = {\n  // Single-qubit gates\n  H: { name: 'Hadamard', description: 'Creates superposition |0⟩→|+⟩, |1⟩→|-⟩', color: '#6496ff', category: 'single' },\n  X: { name: 'Pauli-X', description: 'Bit flip (NOT gate)', color: '#ff6666', category: 'single' },\n  Y: { name: 'Pauli-Y', description: 'Bit + phase flip', color: '#66cc66', category: 'single' },\n  Z: { name: 'Pauli-Z', description: 'Phase flip |1⟩→-|1⟩', color: '#ffcc44', category: 'single' },\n  S: { name: 'S Gate', description: 'Phase gate π/2 (√Z)', color: '#ff66ff', category: 'single' },\n  T: { name: 'T Gate', description: 'Phase gate π/4 (√S)', color: '#66ffff', category: 'single' },\n  Sdg: { name: 'S†', description: 'S-dagger (inverse S)', color: '#cc44cc', category: 'single', symbol: 'S†' },\n  Tdg: { name: 'T†', description: 'T-dagger (inverse T)', color: '#44cccc', category: 'single', symbol: 'T†' },\n  SX: { name: '√X', description: 'Square root of X', color: '#ff8888', category: 'single', symbol: '√X' },\n  I: { name: 'Identity', description: 'Identity (no operation)', color: '#888888', category: 'single' },\n\n  // Rotation gates\n  Rx: { name: 'Rx(θ)', description: 'X-axis rotation', color: '#ff4444', category: 'rotation', needsAngle: true },\n  Ry: { name: 'Ry(θ)', description: 'Y-axis rotation', color: '#44ff44', category: 'rotation', needsAngle: true },\n  Rz: { name: 'Rz(θ)', description: 'Z-axis rotation', color: '#ffff44', category: 'rotation', needsAngle: true },\n  P: { name: 'Phase(θ)', description: 'Phase rotation', color: '#ff88ff', category: 'rotation', symbol: 'P', needsAngle: true },\n  U: { name: 'U Gate', description: 'Universal single-qubit gate', color: '#8888ff', category: 'rotation', needsAngle: true },\n\n  // Two-qubit gates\n  CNOT: { name: 'CNOT', description: 'Controlled-X (CX)', color: '#9966ff', category: 'two-qubit', symbol: 'CX', needsControl: true },\n  CY: { name: 'CY', description: 'Controlled-Y', color: '#66aa66', category: 'two-qubit', needsControl: true },\n  CZ: { name: 'CZ', description: 'Controlled-Z', color: '#ff9966', category: 'two-qubit', needsControl: true },\n  CH: { name: 'CH', description: 'Controlled-Hadamard', color: '#6699ff', category: 'two-qubit', needsControl: true },\n  CP: { name: 'CPhase', description: 'Controlled-Phase', color: '#cc66ff', category: 'two-qubit', needsControl: true, needsAngle: true },\n  SWAP: { name: 'SWAP', description: 'Swap two qubits', color: '#66ff99', category: 'two-qubit', symbol: '⨯' },\n  iSWAP: { name: 'iSWAP', description: 'iSWAP gate', color: '#99ff66', category: 'two-qubit', symbol: 'i⨯' },\n  DCX: { name: 'DCX', description: 'Double CNOT', color: '#aa66ff', category: 'two-qubit' },\n\n  // Three-qubit gates\n  CCX: { name: 'Toffoli', description: 'Controlled-Controlled-X (CCX)', color: '#ff66cc', category: 'three-qubit', symbol: 'CCX', needsTwoControls: true },\n  CCZ: { name: 'CCZ', description: 'Controlled-Controlled-Z', color: '#ffaa66', category: 'three-qubit', needsTwoControls: true },\n  CSWAP: { name: 'Fredkin', description: 'Controlled-SWAP', color: '#66ffcc', category: 'three-qubit', needsTwoControls: true },\n\n  // Special elements\n  M: { name: 'Measure', description: 'Measurement in Z basis', color: '#ffffff', category: 'special', symbol: 'M' },\n  Reset: { name: 'Reset', description: 'Reset qubit to |0⟩', color: '#aaaaaa', category: 'special', symbol: '|0⟩' },\n  Barrier: { name: 'Barrier', description: 'Visual separator (no operation)', color: '#555555', category: 'special', symbol: '│' },\n};\n\nconst NUM_TIME_SLOTS = 12;\nconst MAX_QUBITS = 8;\n\n// Gate categories for the palette\nconst GATE_CATEGORIES = {\n  'Single Qubit': ['H', 'X', 'Y', 'Z', 'S', 'T', 'Sdg', 'Tdg', 'SX', 'I'] as GateType[],\n  'Rotations': ['Rx', 'Ry', 'Rz', 'P', 'U'] as GateType[],\n  'Two Qubit': ['CNOT', 'CY', 'CZ', 'CH', 'CP', 'SWAP', 'iSWAP', 'DCX'] as GateType[],\n  'Three Qubit': ['CCX', 'CCZ', 'CSWAP'] as GateType[],\n  'Special': ['M', 'Reset', 'Barrier'] as GateType[],\n};\n\nconst Playground: React.FC = () => {\n  const logoUrl = `${import.meta.env.BASE_URL}moonlab.png`;\n  const [circuit, setCircuit] = useState<CircuitState>({\n    numQubits: 3,\n    numSlots: NUM_TIME_SLOTS,\n    gates: [],\n  });\n  const [probabilities, setProbabilities] = useState<number[]>([]);\n  const [selectedGate, setSelectedGate] = useState<GateType | null>(null);\n  const [isSimulating, setIsSimulating] = useState(false);\n  const [expandedCategory, setExpandedCategory] = useState<string>('Single Qubit');\n  const [controlMode, setControlMode] = useState<'target' | 'control1' | 'control2'>('target');\n  const [pendingGate, setPendingGate] = useState<{ timeSlot: number; controlQubit?: number; controlQubit2?: number } | null>(null);\n  const [rotationAngle, setRotationAngle] = useState<number>(Math.PI / 2);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const blochCanvasRef = useRef<HTMLCanvasElement>(null);\n\n  const getGateAt = useCallback((qubit: number, timeSlot: number): Gate | undefined => {\n    return circuit.gates.find(g =>\n      (g.qubit === qubit || g.controlQubit === qubit || g.controlQubit2 === qubit || g.targetQubit === qubit)\n      && g.timeSlot === timeSlot\n    );\n  }, [circuit.gates]);\n\n  const isMultiQubitGate = (type: GateType): boolean => {\n    const info = GATE_INFO[type];\n    return info.needsControl || info.needsTwoControls || type === 'SWAP' || type === 'iSWAP' || type === 'DCX';\n  };\n\n  const addGate = useCallback((qubit: number, timeSlot: number) => {\n    if (!selectedGate) return;\n\n    const gateInfo = GATE_INFO[selectedGate];\n\n    // Check if there's already a gate at this position\n    const existingGate = getGateAt(qubit, timeSlot);\n    if (existingGate && !pendingGate) {\n      // Remove existing gate if clicking on it\n      setCircuit(prev => ({\n        ...prev,\n        gates: prev.gates.filter(g => g.id !== existingGate.id),\n      }));\n      return;\n    }\n\n    // Handle multi-qubit gates\n    if (isMultiQubitGate(selectedGate)) {\n      if (gateInfo.needsTwoControls) {\n        // Three-qubit gate: need two controls + target\n        if (controlMode === 'control1') {\n          setPendingGate({ timeSlot, controlQubit: qubit });\n          setControlMode('control2');\n          return;\n        } else if (controlMode === 'control2' && pendingGate) {\n          if (qubit === pendingGate.controlQubit) return; // Same qubit\n          setPendingGate({ ...pendingGate, controlQubit2: qubit });\n          setControlMode('target');\n          return;\n        } else if (controlMode === 'target' && pendingGate?.controlQubit !== undefined && pendingGate?.controlQubit2 !== undefined) {\n          if (qubit === pendingGate.controlQubit || qubit === pendingGate.controlQubit2) return;\n          const newGate: Gate = {\n            id: `gate-${Date.now()}-${Math.random()}`,\n            type: selectedGate,\n            qubit,\n            timeSlot: pendingGate.timeSlot,\n            controlQubit: pendingGate.controlQubit,\n            controlQubit2: pendingGate.controlQubit2,\n            angle: gateInfo.needsAngle ? rotationAngle : undefined,\n          };\n          setCircuit(prev => ({ ...prev, gates: [...prev.gates, newGate] }));\n          setPendingGate(null);\n          setControlMode('control1');\n          return;\n        }\n      } else if (gateInfo.needsControl || selectedGate === 'SWAP' || selectedGate === 'iSWAP' || selectedGate === 'DCX') {\n        // Two-qubit gate: need control + target\n        if (controlMode === 'control1') {\n          setPendingGate({ timeSlot, controlQubit: qubit });\n          setControlMode('target');\n          return;\n        } else if (controlMode === 'target' && pendingGate?.controlQubit !== undefined) {\n          if (qubit === pendingGate.controlQubit) return; // Same qubit\n          const newGate: Gate = {\n            id: `gate-${Date.now()}-${Math.random()}`,\n            type: selectedGate,\n            qubit,\n            timeSlot: pendingGate.timeSlot,\n            controlQubit: pendingGate.controlQubit,\n            angle: gateInfo.needsAngle ? rotationAngle : undefined,\n          };\n          setCircuit(prev => ({ ...prev, gates: [...prev.gates, newGate] }));\n          setPendingGate(null);\n          setControlMode('control1');\n          return;\n        }\n      }\n    }\n\n    // Single-qubit gate or first click for multi-qubit\n    if (isMultiQubitGate(selectedGate)) {\n      setPendingGate({ timeSlot });\n      setControlMode(gateInfo.needsTwoControls ? 'control1' : 'control1');\n      addGate(qubit, timeSlot); // Recursive call to start the flow\n      return;\n    }\n\n    const newGate: Gate = {\n      id: `gate-${Date.now()}-${Math.random()}`,\n      type: selectedGate,\n      qubit,\n      timeSlot,\n      angle: gateInfo.needsAngle ? rotationAngle : undefined,\n    };\n\n    setCircuit(prev => ({\n      ...prev,\n      gates: [...prev.gates, newGate],\n    }));\n  }, [selectedGate, getGateAt, pendingGate, controlMode, rotationAngle]);\n\n  const clearCircuit = useCallback(() => {\n    setCircuit(prev => ({ ...prev, gates: [] }));\n    setProbabilities([]);\n    setPendingGate(null);\n    setControlMode('control1');\n  }, []);\n\n  const setNumQubits = useCallback((n: number) => {\n    setCircuit({ numQubits: n, numSlots: NUM_TIME_SLOTS, gates: [] });\n    setProbabilities([]);\n    setPendingGate(null);\n  }, []);\n\n  const selectGate = useCallback((gate: GateType) => {\n    if (selectedGate === gate) {\n      setSelectedGate(null);\n      setPendingGate(null);\n      setControlMode('control1');\n    } else {\n      setSelectedGate(gate);\n      setPendingGate(null);\n      setControlMode(GATE_INFO[gate].needsTwoControls ? 'control1' :\n                     (GATE_INFO[gate].needsControl || gate === 'SWAP' || gate === 'iSWAP' || gate === 'DCX') ? 'control1' : 'target');\n    }\n  }, [selectedGate]);\n\n  const simulateCircuit = useCallback(async () => {\n    setIsSimulating(true);\n    try {\n      await ensureMoonlabWorker();\n      const sortedGates = [...circuit.gates].sort((a, b) => a.timeSlot - b.timeSlot);\n      const workerGates: WorkerGate[] = sortedGates.map((gate) => ({\n        type: gate.type,\n        qubit: gate.qubit,\n        controlQubit: gate.controlQubit,\n        controlQubit2: gate.controlQubit2,\n        angle: gate.angle,\n      }));\n      const result = await runCircuitInWorker({\n        numQubits: circuit.numQubits,\n        gates: workerGates,\n      });\n      if (result.warnings.length) {\n        console.warn('Playground gate warnings:', result.warnings);\n      }\n      setProbabilities(Array.from(result.probabilities));\n    } catch (error) {\n      console.error('Failed to simulate circuit', error);\n      setProbabilities([]);\n    } finally {\n      setIsSimulating(false);\n    }\n  }, [circuit]);\n\n  // Draw amplitude bars\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear canvas\n    ctx.fillStyle = '#0d0d1a';\n    ctx.fillRect(0, 0, width, height);\n\n    // If no probabilities, show placeholder\n    if (probabilities.length === 0) {\n      ctx.fillStyle = '#404060';\n      ctx.font = '14px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText('Click \"Simulate\" to see results', width / 2, height / 2);\n      return;\n    }\n\n    const barWidth = Math.max(4, (width - 40) / probabilities.length - 2);\n    const maxHeight = height - 60;\n\n    // Draw bars\n    probabilities.forEach((prob, i) => {\n      const x = 20 + i * (barWidth + 2);\n      const barHeight = prob * maxHeight;\n      const y = height - 30 - barHeight;\n\n      // Bar gradient\n      const gradient = ctx.createLinearGradient(x, y + barHeight, x, y);\n      gradient.addColorStop(0, '#6496ff');\n      gradient.addColorStop(1, '#9966ff');\n      ctx.fillStyle = gradient;\n      ctx.fillRect(x, y, barWidth, barHeight);\n\n      // State label\n      if (probabilities.length <= 16) {\n        ctx.fillStyle = '#606080';\n        ctx.font = '10px monospace';\n        ctx.textAlign = 'center';\n        const label = i.toString(2).padStart(circuit.numQubits, '0');\n        ctx.fillText(`|${label}⟩`, x + barWidth / 2, height - 10);\n      }\n    });\n\n    // Y-axis\n    ctx.strokeStyle = '#303050';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(15, 20);\n    ctx.lineTo(15, height - 30);\n    ctx.stroke();\n\n    // Y-axis labels\n    ctx.fillStyle = '#606080';\n    ctx.font = '10px sans-serif';\n    ctx.textAlign = 'right';\n    ctx.fillText('1.0', 12, 25);\n    ctx.fillText('0.5', 12, height / 2);\n    ctx.fillText('0.0', 12, height - 32);\n  }, [probabilities, circuit.numQubits]);\n\n  // Draw simple Bloch sphere representation\n  useEffect(() => {\n    const canvas = blochCanvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const cx = width / 2;\n    const cy = height / 2;\n    const radius = Math.min(width, height) / 2 - 30;\n\n    ctx.fillStyle = '#0d0d1a';\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw sphere outline\n    ctx.strokeStyle = 'rgba(100, 150, 255, 0.3)';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.arc(cx, cy, radius, 0, Math.PI * 2);\n    ctx.stroke();\n\n    // Draw axes\n    const drawAxis = (angle: number, label: string, color: string) => {\n      const x = cx + Math.cos(angle) * radius;\n      const y = cy + Math.sin(angle) * radius;\n      ctx.strokeStyle = color;\n      ctx.lineWidth = 1;\n      ctx.beginPath();\n      ctx.moveTo(cx, cy);\n      ctx.lineTo(x, y);\n      ctx.stroke();\n\n      ctx.fillStyle = color;\n      ctx.font = '12px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText(label, x + Math.cos(angle) * 15, y + Math.sin(angle) * 15 + 4);\n    };\n\n    drawAxis(-Math.PI / 2, '|0⟩', '#00ff88');\n    drawAxis(Math.PI / 2, '|1⟩', '#ff6688');\n    drawAxis(0, '+X', '#6496ff');\n    drawAxis(Math.PI, '-X', '#6496ff');\n\n    // Draw state vector based on probabilities\n    if (probabilities.length === 2) {\n      const theta = Math.acos(Math.sqrt(probabilities[0])) * 2;\n      const stateX = cx + Math.sin(theta) * radius * 0.9;\n      const stateY = cy - Math.cos(theta) * radius * 0.9;\n\n      // State vector arrow\n      ctx.strokeStyle = '#ffcc00';\n      ctx.lineWidth = 3;\n      ctx.beginPath();\n      ctx.moveTo(cx, cy);\n      ctx.lineTo(stateX, stateY);\n      ctx.stroke();\n\n      // Arrow head\n      ctx.fillStyle = '#ffcc00';\n      ctx.beginPath();\n      ctx.arc(stateX, stateY, 6, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  }, [probabilities]);\n\n  const getPlacementHint = (): string => {\n    if (!selectedGate) return 'Select a gate from the palette';\n    const info = GATE_INFO[selectedGate];\n    if (info.needsTwoControls) {\n      if (controlMode === 'control1') return `Click to place first control for ${info.name}`;\n      if (controlMode === 'control2') return `Click to place second control for ${info.name}`;\n      return `Click to place target for ${info.name}`;\n    }\n    if (info.needsControl || selectedGate === 'SWAP' || selectedGate === 'iSWAP' || selectedGate === 'DCX') {\n      if (controlMode === 'control1') return `Click to place ${selectedGate === 'SWAP' || selectedGate === 'iSWAP' ? 'first qubit' : 'control'} for ${info.name}`;\n      return `Click to place ${selectedGate === 'SWAP' || selectedGate === 'iSWAP' ? 'second qubit' : 'target'} for ${info.name}`;\n    }\n    return `Click to place ${info.name}`;\n  };\n\n  return (\n    <div className=\"playground\">\n      <div className=\"section-header\">\n        <img className=\"section-logo\" src={logoUrl} alt=\"\" aria-hidden=\"true\" />\n        <div className=\"section-header-text\">\n          <h1 className=\"section-title\">Quantum Circuit Playground</h1>\n          <p className=\"section-description\">\n            Build quantum circuits interactively. Select a gate, then click on the circuit grid to place it.\n          </p>\n        </div>\n      </div>\n\n      <div className=\"playground-layout\">\n        {/* Gate Palette */}\n        <div className=\"gate-palette\">\n          <h3 className=\"palette-title\">Gates</h3>\n\n          {Object.entries(GATE_CATEGORIES).map(([category, gates]) => (\n            <div key={category} className=\"gate-category\">\n              <button\n                className={`category-header ${expandedCategory === category ? 'expanded' : ''}`}\n                onClick={() => setExpandedCategory(expandedCategory === category ? '' : category)}\n              >\n                <span>{category}</span>\n                <span className=\"category-arrow\">{expandedCategory === category ? '▼' : '▶'}</span>\n              </button>\n              {expandedCategory === category && (\n                <div className=\"gate-grid\">\n                  {gates.map(gate => (\n                    <button\n                      key={gate}\n                      className={`gate-btn ${selectedGate === gate ? 'selected' : ''}`}\n                      style={{ borderColor: GATE_INFO[gate].color }}\n                      onClick={() => selectGate(gate)}\n                      title={GATE_INFO[gate].description}\n                    >\n                      <span className=\"gate-symbol\" style={{ color: GATE_INFO[gate].color }}>\n                        {GATE_INFO[gate].symbol || gate}\n                      </span>\n                      <span className=\"gate-name\">{GATE_INFO[gate].name}</span>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          ))}\n\n          {/* Rotation angle control */}\n          {selectedGate && GATE_INFO[selectedGate].needsAngle && (\n            <div className=\"palette-section\">\n              <h4>Rotation Angle</h4>\n              <div className=\"angle-control\">\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max={2 * Math.PI}\n                  step={Math.PI / 8}\n                  value={rotationAngle}\n                  onChange={(e) => setRotationAngle(parseFloat(e.target.value))}\n                />\n                <span className=\"angle-value\">{(rotationAngle / Math.PI).toFixed(2)}π</span>\n              </div>\n              <div className=\"angle-presets\">\n                {[['π/4', Math.PI/4], ['π/2', Math.PI/2], ['π', Math.PI], ['3π/2', 3*Math.PI/2]].map(([label, val]) => (\n                  <button\n                    key={label}\n                    className={`angle-preset ${Math.abs(rotationAngle - (val as number)) < 0.01 ? 'selected' : ''}`}\n                    onClick={() => setRotationAngle(val as number)}\n                  >\n                    {label}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"palette-section\">\n            <h4>Qubits ({circuit.numQubits})</h4>\n            <div className=\"qubit-selector\">\n              {Array.from({ length: MAX_QUBITS }, (_, i) => i + 1).map(n => (\n                <button\n                  key={n}\n                  className={`qubit-btn ${circuit.numQubits === n ? 'selected' : ''}`}\n                  onClick={() => setNumQubits(n)}\n                >\n                  {n}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"palette-actions\">\n            <button className=\"btn btn-primary\" onClick={simulateCircuit} disabled={isSimulating}>\n              {isSimulating ? 'Simulating...' : 'Simulate'}\n            </button>\n            <button className=\"btn btn-secondary\" onClick={clearCircuit}>\n              Clear\n            </button>\n          </div>\n        </div>\n\n        {/* Circuit Editor */}\n        <div className=\"circuit-editor\">\n          <h3>Circuit</h3>\n          <div className=\"circuit-grid-container\">\n            {/* Time slot headers */}\n            <div className=\"time-slot-header\">\n              <div className=\"qubit-label-spacer\"></div>\n              {Array.from({ length: circuit.numSlots }, (_, t) => (\n                <div key={t} className=\"time-slot-label\">t{t}</div>\n              ))}\n              <div className=\"measurement-spacer\"></div>\n            </div>\n\n            {/* Qubit wires with grid cells */}\n            {Array.from({ length: circuit.numQubits }, (_, q) => (\n              <div key={q} className=\"qubit-row\">\n                <span className=\"qubit-label\">q{q}</span>\n                <div className=\"wire-grid\">\n                  {Array.from({ length: circuit.numSlots }, (_, t) => {\n                    const gate = getGateAt(q, t);\n                    const isPendingSlot = pendingGate?.timeSlot === t;\n                    const isControl1 = pendingGate?.controlQubit === q && isPendingSlot;\n                    const isControl2 = pendingGate?.controlQubit2 === q && isPendingSlot;\n\n                    // Check if this cell is part of a multi-qubit gate\n                    const multiGate = circuit.gates.find(g =>\n                      g.timeSlot === t && (g.controlQubit === q || g.controlQubit2 === q)\n                    );\n                    const isControlNode = !!multiGate && (multiGate.controlQubit === q || multiGate.controlQubit2 === q);\n\n                    // Render gate symbol\n                    const renderGateSymbol = () => {\n                      if (isControl1 || isControl2) {\n                        return (\n                          <div className=\"control-node pending\" title=\"Control qubit (pending)\">●</div>\n                        );\n                      }\n                      if (isControlNode && multiGate) {\n                        return (\n                          <div\n                            className=\"control-node\"\n                            style={{ color: GATE_INFO[multiGate.type].color }}\n                            title={`Control for ${multiGate.type}`}\n                          >●</div>\n                        );\n                      }\n                      if (gate && gate.qubit === q) {\n                        return (\n                          <div\n                            className={`gate-on-grid ${gate.type === 'Barrier' ? 'barrier' : ''}`}\n                            style={{ backgroundColor: GATE_INFO[gate.type].color }}\n                            title={`${GATE_INFO[gate.type].name}${gate.angle ? ` (${(gate.angle / Math.PI).toFixed(2)}π)` : ''}`}\n                          >\n                            {GATE_INFO[gate.type].symbol || gate.type}\n                          </div>\n                        );\n                      }\n                      return null;\n                    };\n\n                    return (\n                      <div\n                        key={t}\n                        className={`grid-cell ${selectedGate ? 'clickable' : ''} ${gate ? 'has-gate' : ''} ${isPendingSlot ? 'pending-slot' : ''}`}\n                        onClick={() => addGate(q, t)}\n                      >\n                        <div className=\"wire-segment\"></div>\n                        {renderGateSymbol()}\n                        {/* Draw connection line for multi-qubit gates */}\n                        {gate && gate.qubit === q && gate.controlQubit !== undefined && (\n                          <div\n                            className=\"gate-connection\"\n                            style={{\n                              height: `${Math.abs(gate.controlQubit - q) * 50}px`,\n                              top: gate.controlQubit < q ? `${(gate.controlQubit - q) * 50 + 25}px` : '25px',\n                              borderColor: GATE_INFO[gate.type].color,\n                            }}\n                          />\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n                <span className=\"measurement\">M</span>\n              </div>\n            ))}\n          </div>\n          <p className={`hint ${pendingGate ? 'pending' : ''}`}>{getPlacementHint()}</p>\n          {pendingGate && (\n            <button className=\"btn btn-cancel\" onClick={() => { setPendingGate(null); setControlMode('control1'); }}>\n              Cancel Placement\n            </button>\n          )}\n        </div>\n\n        {/* Visualization */}\n        <div className=\"visualization-panel\">\n          <div className=\"viz-card\">\n            <h3>Probability Amplitudes</h3>\n            <canvas ref={canvasRef} width={400} height={200} className=\"viz-canvas\" />\n          </div>\n          {circuit.numQubits === 1 && (\n            <div className=\"viz-card\">\n              <h3>Bloch Sphere</h3>\n              <canvas ref={blochCanvasRef} width={200} height={200} className=\"viz-canvas\" />\n            </div>\n          )}\n          {probabilities.length > 0 && (\n            <div className=\"viz-card stats-card\">\n              <h3>Statistics</h3>\n              <div className=\"stats-grid\">\n                <div className=\"stat\">\n                  <span className=\"stat-label\">States</span>\n                  <span className=\"stat-value\">{probabilities.length}</span>\n                </div>\n                <div className=\"stat\">\n                  <span className=\"stat-label\">Non-zero</span>\n                  <span className=\"stat-value\">\n                    {probabilities.filter(p => p > 0.001).length}\n                  </span>\n                </div>\n                <div className=\"stat\">\n                  <span className=\"stat-label\">Max Prob</span>\n                  <span className=\"stat-value\">\n                    {(Math.max(...probabilities) * 100).toFixed(1)}%\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Playground;\n"],"names":["GATE_INFO","NUM_TIME_SLOTS","MAX_QUBITS","GATE_CATEGORIES","Playground","logoUrl","circuit","setCircuit","useState","probabilities","setProbabilities","selectedGate","setSelectedGate","isSimulating","setIsSimulating","expandedCategory","setExpandedCategory","controlMode","setControlMode","pendingGate","setPendingGate","rotationAngle","setRotationAngle","canvasRef","useRef","blochCanvasRef","getGateAt","useCallback","qubit","timeSlot","g","isMultiQubitGate","type","info","addGate","gateInfo","existingGate","prev","newGate","clearCircuit","setNumQubits","n","selectGate","gate","simulateCircuit","ensureMoonlabWorker","workerGates","b","result","runCircuitInWorker","error","useEffect","canvas","ctx","width","height","barWidth","maxHeight","prob","i","x","barHeight","y","gradient","label","cx","cy","radius","drawAxis","angle","color","theta","stateX","stateY","getPlacementHint","jsxs","jsx","category","gates","val","_","q","t","isPendingSlot","isControl1","isControl2","multiGate","isControlNode","renderGateSymbol","p"],"mappings":"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"}