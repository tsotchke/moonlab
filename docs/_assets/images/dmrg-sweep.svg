<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520">
  <defs>
    <linearGradient id="leftEnvGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="rightEnvGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fb923c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="activeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mpoLineGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#9333ea;stop-opacity:1" />
    </linearGradient>
    <marker id="sweepArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1f2937">DMRG Sweep Algorithm</text>

  <!-- Sweep direction indicators -->
  <g transform="translate(50, 55)">
    <text x="350" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#374151">Right Sweep (→)</text>
    <path d="M150 10 L550 10" stroke="#10b981" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#sweepArrow)"/>
  </g>

  <!-- Right sweep visualization -->
  <g transform="translate(50, 90)">
    <!-- Left environment (contracted) -->
    <g>
      <polygon points="20,40 80,20 80,100 20,80" fill="url(#leftEnvGrad)" stroke="#2563eb" stroke-width="2"/>
      <text x="50" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="white">L</text>
      <text x="50" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#3b82f6">Left Env</text>
    </g>

    <!-- MPO row -->
    <g transform="translate(0, 35)">
      <rect x="100" y="0" width="30" height="30" rx="4" fill="url(#mpoLineGrad)"/>
      <text x="115" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="bold" fill="white">W</text>

      <rect x="145" y="0" width="30" height="30" rx="4" fill="url(#mpoLineGrad)"/>
      <text x="160" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="bold" fill="white">W</text>
    </g>

    <!-- Active sites (two-site DMRG) -->
    <g>
      <rect x="100" y="0" width="75" height="35" rx="5" fill="url(#activeGrad)" stroke="#047857" stroke-width="2"/>
      <text x="137" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="white">Active Sites</text>
      <line x1="115" y1="0" x2="115" y2="-15" stroke="#ef4444" stroke-width="2"/>
      <line x1="160" y1="0" x2="160" y2="-15" stroke="#ef4444" stroke-width="2"/>
    </g>

    <!-- Right environment -->
    <g>
      <polygon points="195,40 255,20 255,100 195,80" fill="url(#rightEnvGrad)" stroke="#ea580c" stroke-width="2"/>
      <text x="225" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="white">R</text>
      <text x="225" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#f97316">Right Env</text>

      <!-- Uncontracted sites inside R -->
      <rect x="270" y="45" width="20" height="20" rx="3" fill="#fcd34d" stroke="#d97706" stroke-width="1"/>
      <rect x="300" y="45" width="20" height="20" rx="3" fill="#fcd34d" stroke="#d97706" stroke-width="1"/>
      <rect x="330" y="45" width="20" height="20" rx="3" fill="#fcd34d" stroke="#d97706" stroke-width="1"/>
      <text x="310" y="80" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#6b7280">remaining sites</text>
    </g>

    <!-- Eigenvalue problem box -->
    <g transform="translate(400, 10)">
      <rect x="0" y="0" width="280" height="80" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>
      <text x="140" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#059669">Local Eigenvalue Problem</text>
      <text x="140" y="42" text-anchor="middle" font-family="serif" font-size="11" fill="#374151">H_eff |ψ_local⟩ = E |ψ_local⟩</text>
      <text x="140" y="62" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6b7280">Lanczos/Davidson diagonalization</text>
    </g>
  </g>

  <!-- Left sweep visualization -->
  <g transform="translate(50, 245)">
    <text x="350" y="-15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#374151">Left Sweep (←)</text>
    <path d="M550 -5 L150 -5" stroke="#3b82f6" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#sweepArrow)"/>

    <!-- Left environment with more sites -->
    <g>
      <polygon points="20,40 80,20 80,100 20,80" fill="url(#leftEnvGrad)" stroke="#2563eb" stroke-width="2"/>
      <text x="50" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="white">L</text>

      <rect x="95" y="45" width="20" height="20" rx="3" fill="#93c5fd" stroke="#3b82f6" stroke-width="1"/>
      <rect x="125" y="45" width="20" height="20" rx="3" fill="#93c5fd" stroke="#3b82f6" stroke-width="1"/>
      <text x="120" y="80" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#6b7280">already swept</text>
    </g>

    <!-- Active sites (now on right side) -->
    <g transform="translate(160, 0)">
      <rect x="0" y="0" width="75" height="35" rx="5" fill="url(#activeGrad)" stroke="#047857" stroke-width="2"/>
      <text x="37" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="white">Active Sites</text>
      <line x1="15" y1="0" x2="15" y2="-15" stroke="#ef4444" stroke-width="2"/>
      <line x1="60" y1="0" x2="60" y2="-15" stroke="#ef4444" stroke-width="2"/>
    </g>

    <!-- Right environment (smaller) -->
    <g transform="translate(55, 0)">
      <polygon points="195,40 255,20 255,100 195,80" fill="url(#rightEnvGrad)" stroke="#ea580c" stroke-width="2"/>
      <text x="225" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="white">R</text>
    </g>

    <!-- SVD truncation box -->
    <g transform="translate(400, 10)">
      <rect x="0" y="0" width="280" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
      <text x="140" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#92400e">SVD Truncation</text>
      <text x="140" y="42" text-anchor="middle" font-family="serif" font-size="11" fill="#374151">|ψ_local⟩ = U S V† → truncate to χ</text>
      <text x="140" y="62" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6b7280">Update MPS tensors A, B</text>
    </g>
  </g>

  <!-- Convergence diagram -->
  <g transform="translate(50, 390)">
    <rect x="0" y="0" width="700" height="110" rx="10" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>
    <text x="350" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#374151">DMRG Convergence</text>

    <!-- Energy vs sweep plot sketch -->
    <g transform="translate(50, 35)">
      <line x1="0" y1="60" x2="200" y2="60" stroke="#374151" stroke-width="1.5"/>
      <line x1="0" y1="0" x2="0" y2="60" stroke="#374151" stroke-width="1.5"/>
      <text x="100" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6b7280">Sweep number</text>
      <text x="-10" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6b7280" transform="rotate(-90, -10, 30)">Energy</text>

      <!-- Convergence curve -->
      <path d="M10 10 Q30 20 50 35 Q80 45 120 52 Q160 56 190 58" stroke="#10b981" stroke-width="2" fill="none"/>
      <line x1="0" y1="58" x2="200" y2="58" stroke="#ef4444" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="210" y="62" font-family="system-ui, sans-serif" font-size="8" fill="#ef4444">E₀</text>
    </g>

    <!-- Key steps -->
    <g transform="translate(300, 40)">
      <text x="0" y="0" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="#374151">Algorithm Steps:</text>
      <text x="10" y="18" font-family="system-ui, sans-serif" font-size="9" fill="#374151">1. Initialize random MPS</text>
      <text x="10" y="33" font-family="system-ui, sans-serif" font-size="9" fill="#374151">2. Build environment tensors L, R</text>
      <text x="10" y="48" font-family="system-ui, sans-serif" font-size="9" fill="#374151">3. Solve local eigenvalue problem</text>
      <text x="10" y="63" font-family="system-ui, sans-serif" font-size="9" fill="#374151">4. SVD and update MPS</text>
    </g>

    <g transform="translate(520, 40)">
      <text x="0" y="0" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="#374151">Convergence Criteria:</text>
      <text x="10" y="18" font-family="system-ui, sans-serif" font-size="9" fill="#374151">|E_n - E_{n-1}| &lt; ε</text>
      <text x="10" y="33" font-family="system-ui, sans-serif" font-size="9" fill="#374151">Typically ε ~ 10⁻⁸ to 10⁻¹²</text>
      <text x="10" y="48" font-family="system-ui, sans-serif" font-size="9" fill="#374151">5-20 sweeps typical</text>
    </g>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 510)">
    <polygon points="0,5 15,0 15,15 0,10" fill="url(#leftEnvGrad)" stroke="#2563eb" stroke-width="1"/>
    <text x="25" y="12" font-family="system-ui, sans-serif" font-size="9" fill="#374151">Left environment</text>

    <polygon points="120,5 135,0 135,15 120,10" fill="url(#rightEnvGrad)" stroke="#ea580c" stroke-width="1"/>
    <text x="145" y="12" font-family="system-ui, sans-serif" font-size="9" fill="#374151">Right environment</text>

    <rect x="250" y="0" width="20" height="15" rx="3" fill="url(#activeGrad)"/>
    <text x="280" y="12" font-family="system-ui, sans-serif" font-size="9" fill="#374151">Active sites (optimized)</text>

    <rect x="420" y="0" width="20" height="15" rx="3" fill="url(#mpoLineGrad)"/>
    <text x="450" y="12" font-family="system-ui, sans-serif" font-size="9" fill="#374151">MPO (Hamiltonian)</text>

    <text x="600" y="12" font-family="serif" font-size="10" fill="#374151">Cost: O(n · χ³ · D²)</text>
  </g>
</svg>
